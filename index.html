<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Oliver_Scanner_V17_Grok</title>
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@700;800;900&family=DM+Mono:wght@300;400;500&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
/* Your full v16 CSS — copied from what you pasted */
*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }

:root {
  --bg:       #03050b;
  --bg2:      #070c16;
  --bg3:      #0d1520;
  --ink:      #ffffff;
  --ink2:     #ffffff;
  --ink3:     #cccccc;
  --ink4:     #5a7a96;
  --rule:     rgba(255,255,255,0.07);
  --rule2:    rgba(255,255,255,0.04);
  --buy:      #00ff88;
  --buy-bg:   rgba(0,255,136,0.07);
  --buy-rule: rgba(0,255,136,0.35);
  --sell:     #ff1744;
  --sell-bg:  rgba(255,23,68,0.07);
  --sell-rule:rgba(255,23,68,0.35);
  --hold:     #ffe600;
  --hold-bg:  rgba(255,230,0,0.06);
  --hold-rule:rgba(255,230,0,0.35);
  --narrow:   #00b4ff;
  --narrow-bg:rgba(0,180,255,0.07);
  --expand:   #ff8c00;
  --expand-bg:rgba(255,140,0,0.07);
}

html { font-size:13px; }
body {
  background: var(--bg);
  color: var(--ink);
  font-family: 'DM Sans', sans-serif;
  font-weight: 300;
  min-height: 100vh;
  -webkit-font-smoothing: antialiased;
  display: flex;
  flex-direction: column;
}

/* GATE BAR */
.gate-bar {
  position: sticky; top: 0; z-index: 100; margin: 0 -0px;
  display: flex; align-items: center; gap: 20px;
  padding: 8px 24px;
  background: rgba(3,5,11,0.98);
  border-bottom: 1px solid rgba(0,180,255,0.2);
  backdrop-filter: blur(12px);
  flex-shrink: 0;
  border-left: none;
  border-right: none;
}
.gate-label {
  font-family:'DM Mono',monospace; font-size:9px;
  letter-spacing:2px; color:var(--ink4); text-transform:uppercase;
}
.gate-val {
  font-family:'Barlow Condensed',sans-serif;
  font-size:16px; font-weight:800; letter-spacing:1px;
}
.gate-val.open    { color:var(--buy);  text-shadow:0 0 12px rgba(0,255,136,.4); }
.gate-val.watch   { color:var(--hold); text-shadow:0 0 10px rgba(255,230,0,.3); }
.gate-val.closed  { color:var(--ink4); }
.gate-sep { width:1px; height:16px; background:var(--rule); }
.gc-item {
  display:flex; align-items:center; gap:5px;
  font-family:'DM Mono',monospace; font-size:9px;
  letter-spacing:1.5px; color:var(--ink4); text-transform:uppercase;
}
.gc-n { font-size:14px; font-weight:500; font-family:'DM Mono',monospace; }
.gc-n.buy  { color:var(--buy); }
.gc-n.sell { color:var(--sell); }
.gc-n.hold { color:var(--hold); }
.gate-right { margin-left:auto; display:flex; align-items:center; gap:14px; }
.gate-clock {
  font-family:'DM Mono',monospace; font-size:15px;
  color:var(--ink2); letter-spacing:2px;
}
.gate-session {
  display:flex; align-items:center; gap:5px;
  font-family:'DM Mono',monospace; font-size:9px;
  letter-spacing:1.5px; color:var(--ink4); text-transform:uppercase;
}
.sess-dot { width:6px; height:6px; border-radius:50%; background:var(--ink4); }
.sess-dot.live { background:var(--buy); box-shadow:0 0 8px var(--buy); animation:dotpulse 2s infinite; }
@keyframes dotpulse { 0%,100%{opacity:1} 50%{opacity:.3} }

/* HEADER, EDIT BAR, TF BAR, LEGEND, GRID, SYMBOL CARD, DETAIL PANEL, EDIT MODAL — paste your full v16 CSS here if not already included */
</style>
</head>
<body>

<!-- YOUR FULL V16 HTML GOES HERE — gate bar, header, edit bar, tf bar, legend, grid, overlays, panels -->
<!-- If you have it copied from Claude, paste it here -->
<!-- If not, here's the structure skeleton — replace with your exact HTML -->
<div class="gate-bar">
  <span class="gate-label">Gate</span>
  <span class="gate-val closed" id="gate-val">Closed</span>
  <div class="gate-sep"></div>
  <div class="gc-item"><span class="gc-n buy" id="gc-buy">0</span> BUY</div>
  <div class="gc-item"><span class="gc-n sell" id="gc-sell">0</span> SELL</div>
  <div class="gc-item"><span class="gc-n hold" id="gc-hold">0</span> WATCH</div>
  <div class="gate-right">
    <span id="live-indicator" style="font-size:10px;letter-spacing:1px;color:#888;margin-right:8px;">● DEMO</span>
    <div class="gate-session"><span class="sess-dot" id="sess-dot"></span><span id="sess-lbl">Pre-Market</span></div>
    <div class="gate-clock" id="clock">--:--:--</div>
  </div>
</div>

<header>
  <div>
    <div class="h-title">Oliver's Scanner</div>
    <div class="h-sub">Minimalized · 5-Filter Gate</div>
  </div>
</header>

<!-- Add your edit-bar, tf-bar, legend, grid, etc. from v16 -->

<!-- API panel (V17) -->
<div class="api-overlay" id="apiOverlay"></div>
<div class="api-panel" id="apiPanel">
  <div class="api-title">Oliver_Scanner_V17_Grok – Data Source</div>
  <div class="api-provider active" id="prov-fmp">
    <div>Financial Modeling Prep (FMP)</div>
    <div>Real-time + 1-min bars → 2-min • $19/mo Starter</div>
    <div>$19/mo</div>
  </div>
  <div class="api-provider" id="prov-yahoo">
    <div>Yahoo Finance (Demo)</div>
    <div>Free • 15-min delay</div>
    <div>$0</div>
  </div>
  <div class="api-key-row" id="keyRow">
    <div>FMP API Key</div>
    <input id="apiKeyInput" type="password" placeholder="Paste your FMP API key">
  </div>
  <div class="api-btn-row">
    <button onclick="closeApiPanel()">Cancel</button>
    <button onclick="saveApiSettings()">Connect & Scan</button>
  </div>
  <div id="apiStatusMsg"></div>
</div>

<script>
// YOUR FULL V16 JS GOES HERE — paste all your original JS code (variables, functions, initHist, computeOV, runScan, renderAll, etc.)

// Then add these V17 lines at the end

let currentProvider = localStorage.getItem('ov_provider') || 'fmp';
let apiKey = localStorage.getItem('ov_apikey') || '';

function openApiPanel() {
  document.getElementById('apiPanel').style.display = 'block';
  document.getElementById('apiOverlay').style.display = 'block';
}

function closeApiPanel() {
  document.getElementById('apiPanel').style.display = 'none';
  document.getElementById('apiOverlay').style.display = 'none';
}

function saveApiSettings() {
  apiKey = document.getElementById('apiKeyInput').value.trim();
  if (currentProvider !== 'yahoo' && !apiKey) {
    document.getElementById('apiStatusMsg').textContent = 'Enter key';
    return;
  }
  localStorage.setItem('ov_apikey', apiKey);
  localStorage.setItem('ov_provider', currentProvider);
  closeApiPanel();
  fetchLiveData(); // call your original fetch function
}

// FMP fetch (add your aggregation logic here or call your computeOV)
async function fetchLiveData() {
  // your original fetch code, but use apiKey for FMP
  // example: await fetch(`https://financialmodelingprep.com/api/v3/historical-chart/1min/AAPL?apikey=${apiKey}`)
  // then process and call runScan() + renderAll()
}

// Auto-open panel if no key
if (currentProvider === 'fmp' && !apiKey) {
  openApiPanel();
} else {
  // your startLiveData() or fetchLiveData()
}
</script>
</body>
</html>
